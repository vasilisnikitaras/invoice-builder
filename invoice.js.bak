// ------- INITIALIZATION -------
const form = document.querySelector("form");
const preview = document.querySelector("#invoicePreview");
const themeToggle = document.querySelector("#themeToggle");
const langSelect = document.querySelector("#langSelect");
const resetButton = document.querySelector("#resetForm");

const fields = ["company", "client", "items", "date", "tax", "payment"];
const previews = {};
fields.forEach(f => previews[f] = document.querySelector(`#preview${f.charAt(0).toUpperCase() + f.slice(1)}`));

// ------- LIVE PREVIEW -------
fields.forEach(field => {
  document.querySelector(`#${field}`).addEventListener("input", e => {
    previews[field].textContent = e.target.value;
    if(field === "payment") updateQR(e.target.value);
  });
});

// ------- QR CODE GENERATION -------
function updateQR(data) {
  const qr = document.querySelector("#previewQR");
  qr.src = `https://api.qrserver.com/v1/create-qr-code/?size=120x120&data=${encodeURIComponent(data)}`;
}

// ------- THEME TOGGLE -------
themeToggle.addEventListener("click", () => {
  document.body.classList.toggle("dark");
  localStorage.setItem("theme", document.body.classList.contains("dark") ? "dark" : "light");
});
window.addEventListener("load", () => {
  if(localStorage.getItem("theme") === "dark") document.body.classList.add("dark");
});

// ------- LANGUAGE SWITCH -------
langSelect.addEventListener("change", e => {
  const lang = e.target.value;
  document.querySelectorAll("[data-i18n]").forEach(el => {
    el.textContent = translations[lang][el.dataset.i18n] || el.textContent;
  });
});

// Dummy translations (expand as needed)
const translations = {
  el: {
    company: "Εταιρεία",
    client: "Πελάτης",
    items: "Στοιχεία",
    date: "Ημερομηνία",
    tax: "Φόρος",
    payment: "Πληρωμή"
  },
  en: {
    company: "Company",
    client: "Client",
    items: "Items",
    date: "Date",
    tax: "Tax",
    payment: "Payment"
  }
};

// ------- RESET -------
resetButton.addEventListener("click", () => {
  form.reset();
  Object.values(previews).forEach(el => el.textContent = "");
  document.querySelector("#previewQR").src = "";
});
const exportPDFBtn = document.querySelector("#exportPDF");

exportPDFBtn.addEventListener("click", () => {
  const invoiceElement = document.querySelector("#invoicePreview");

  const opt = {
    margin:       0.5,
    filename:     'invoice.pdf',
    image:        { type: 'jpeg', quality: 0.98 },
    html2canvas:  { scale: 2 },
    jsPDF:        { unit: 'in', format: 'letter', orientation: 'portrait' }
  };

  html2pdf().set(opt).from(invoiceElement).save();
});
